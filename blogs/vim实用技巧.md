# vim实用技巧

本笔记是自己学习《vim实用技巧》的总结，因为自己以前折腾过一阵子vim，包括其配置还有插件，以前都是看博客学习，现在想要学习的更深入一点，因此参考了这本书，记录下自己学习和实用vim的心得。

## 该不该学习vim

vim其实学习曲线很陡，需要花费很大的时间才有收益，似乎对于学习编程等方面并没有什么显著提升。但是我觉得如果你是一位linux开发者，或者需要经常登录服务器，还是很有必要学习一下vim的。vim给我的感受就是一但你接受了它，习惯了它，一切就是自然，就跟打字一样，可以说是一辈子陪伴着你。但切记，**学习vim不可能一蹴而就，至少在前期需要不停的日常使用，练习，如果只是单纯的看看一些书，参考一些配置，简单练习，那你是不可能学会的。**

我认为学习vim的最好方式是

> 1.买个好键盘 :blush:
>
> 2.学会盲打 :smile:
>
> 3.保持每天练习 :smirk:

## vim解决问题的方式

vim的哲学是一切**从简，偷懒**，所以骚年，当你觉得这个操作怎么这么鸡肋，有没有更简便的方式是，去网上搜一搜，强大的网友一定能给你满意的答案。:smiley:

### 技巧1：`.`命令

`.`：命令重复，可以让你重复对文本的修改操作。在一般情况我们会在两种模式下进行文本修改操作。

- 普通模式：当我们在普通模式下进行类似`dd`,`x`这样修改文本的操作时，`.`命令会记住上次的修改操作
- 插入模式：当我们按某些键盘进入插入模式，所作的修改直至按`<Esc>`进入普通模式，其中的修改操作

`.`命令类似一个小的宏操作，会记录下我们的对文本的修改操作，再次使用时可以复现这些从操作

### 技巧2：复合命令配合`.`命令

在从普通模式进入插入模式时有许多有效的复合命令，这些命令搭配的修改操作，很容易被`.`命令复制。

| 复合命令 | 等效长命令 | 描述                                                   |
| -------- | ---------- | ------------------------------------------------------ |
| C        | c$         | 将光标当前至末尾的文本删除并进入插入模式（change)      |
| s        | cl         | 替换光标所在letter（字符）并进入插入模式（substitute） |
| S        | ^c         | 替换整行，进入插入模式                                 |
| I        | ^i         | 关标移动到本行最前面一个非空白字符，并进入插入模式     |
| A        | $a         | 光标移动到本行最后一个字符，并进入插入模式             |
| o        | A<CR>      | 在当前行下方新起一行，并进入插入模式                   |
| O        | ko         | 在当前行上方新起一行，并进入插入模式                   |

### 技巧3：以退为进

某些操作，可能不方便我们将命令组合，例如，在某个字符前后各加一个字符，这时候，我们可以退一步，将该字符删除，然后再利用`.`命令重复这些修改操作，这样就成功的复用了命令。例如在一下代码中在=前后各加一个空空格。

```javascript
var foo = "method("+argument1+","+argument2+")";
```

首先利用`f+`命令定位到第一个+号处，然后用`s`命令替换+号进入插入模式，输入`<Space>+<Space>`然后退出到普通模式，这样我们只需要将光标定位到下一个+号处，利用`.`命令重复上次的动作。

> `;`命令可以重复上次`f`查找的字符，并将光标跳到该字符上

### 技巧4：执行、重复、回退

执行，重复是我们尽可能设计vim操作的有效方式，可是有时候，当我们重复执行某些操作的时候，需要进行回退该怎么办？因此，有必要知道某些命令的重复和回退操作

| 目的                     | 操作                    | 重复 | 回退 |
| ------------------------ | ----------------------- | ---- | ---- |
| 做出一个修改             | {edit}                  | `.`  | `u`  |
| 在行内查找下一个字符     | `f{char}`|`t{char}`     | `;`  | `,`  |
| 在行内查找上一个字符     | `F{char}`|`T{char}`     | `;`  | `,`  |
| 在文档中查找下一个匹配项 | `/pattern<CR>`          | `n`  | `N`  |
| 在文档中查找上一个匹配项 | `?pattern<CR>`          | `n`  | `N`  |
| 执行替换                 | `:s/target/replacement` | `&`  | `u`  |

### 技巧5：查找并手动替换

`*`命令能够快速查找光标所在的单词，并跳转到下一个，可以通过`n`和`N`进行切换。

### 技巧6：一次移动，一次执行

总结一下前面的技巧，利用`.`命令封装了一次修改，然后利用某些命令，例如，`A`，`*`，`f`查找需要修改的元素，一次移动，接着一次`.`命令进行修改，这就是我们常说的`.`范式。

## 普通模式

### 技巧7：构造可重复的修改

修改操作，尽量构造成可重复的，例如删除光标所在单词。

| 文本对象 | 描述                   |
| -------- | ---------------------- |
| aw       | a word，一个单词       |
| ap       | a paragraph， 一个段落 |

利用`daw`就可以删除光标所在的单词，并且方便`.`命令的复用。

> 当进行修改的时候，如果有多种方式，思考一下哪种方式能够复用`.`命令

### 技巧8：双剑合璧，天下无敌

**操作符 + 动作命令 = 操作**

vim中将一次操作分解为操作符和动作命令，例如 `d{motion}`命令可以删除一个单词（`daw`），一个段落（`dap`），`c{motion}`，`y{motion}`等。

vim的这种由操作符和动作命令结合的操作，我们只需要学习到新的操作符或者动作命令，可以做任意的结合。vim的语法规则只有额外的一条，当操作符命令被连续调用两次，那么会作用于当前行，例如`dd`删除当前行，`>>`缩进当前行。

| vim操作符命令 | 用途                               |
| ------------- | ---------------------------------- |
| c             | 修改                               |
| d             | 删除                               |
| y             | 复制到寄存器                       |
| g~            | 反转大小写                         |
| gu            | 转换为小写                         |
| gU            | 转换为大写                         |
| >             | 增加缩进                           |
| <             | 减小缩进                           |
| =             | 自动缩进                           |
| !             | 使用外部程序过滤{motion}所跨越的行 |

> 操作符待决模式，当我们按下操作符命令时，会自动进入待决模式，等待一个动作命令，在待决模式下可以通过<Esc>取消操作符。有些命令需要提供前缀（好像一个操作符命令的命名空间）。例如上面的`gu`操作符命令，**g** 就是前缀。

## 插入模式

### 技巧9：在插入模式中更正错误

在插入模式中按某些键可以修正我们的错误，使得我们还继续停留在插入模式。Ctrl和h,j,k,l的组合可以帮助我们做和普通模式下的h,j,k,l操作而继续停留在插入模式。

| 按键操作 | 用途           |
| -------- | -------------- |
| <C-h>    | 同退格键       |
| <C-w>    | 删除前一个单词 |
| <C-u>    | 删除到行首     |

> `zz`命令在普通模式下，重绘制屏幕，将当前光标所在行放置在屏幕中央

### 技巧10：不离开插入模式，粘贴寄存器中的文本

在插入模式下可以复制寄存器的文本内容，方式是`<C-r>{register}`，例如`<C-r>0`就是复制我们最常用的寄存器的内容到当前插入光标处。

### 技巧11：插入模式下的骚操作

1. 在插入模式下，我们可以通过`<C-r>=`进入访问表达寄存器，然后输入表达式进行计算并按<CR>键，计算结果将输出在在插入模式当前位置。

2. 在插入模式下按下`<C-v>`然后输入字符的编码可以插入非常用字符。

   > 如何想知道任意字符的编码，可以在普通模式下在字符下，按`ga`会显示字符的十进制和十六进制编码，八进制编码，二合编码

> R键可以进入替换模式，此时操作就好比在插入模式，不过是替换已有字符。

## 可视模式

### 技巧12：激活高亮选择区域

`gv`命令可以选择上次选择的高亮区域，在选择模式下，`o`命令可以重新从端点开始选择。

结合`.`命令和面向行的高亮选择。

## 命令行模式

## 技巧13：vim常用命令行模式

| 命令                                           | 用途                                                       |
| ---------------------------------------------- | ---------------------------------------------------------- |
| :[range]delete[x]                              | 删除指定范围内的行[到寄存器x中]                            |
| :[range]yank[x]                                | 复制指定范围的行[到寄存器x中]                              |
| :[line]put[x]                                  | 在指定行后粘贴寄存器x中的内容                              |
| :[range]copy{address}                          | 把指定范围内的行拷贝到{address}所指定的行之下              |
| :[range]move{address}                          | 把指定范围内的行移动到{address}所指定的行之下              |
| :[range]join                                   | 连接指定范围内的行                                         |
| :[range]normal{commands}                       | 对指定范围内的每一行做普通模式下的命令                     |
| ：[range]substitute/{pattern}/{string}/[flags] | 把指定范围内出现{pattern}的地方替换为{string}              |
| :[range]global/{pattern}/[cmd]                 | 对指定范围内匹配{pattern}的所有行，在其上执行 Ex 命令{cmd} |



### 技巧14：在一行或者多行连续执行命令

在命令行模式下，利用数字可以跳转到对应的行号并执行命令。

| 地址  | 描述                                                      |
| ----- | --------------------------------------------------------- |
| :3p   | 打印第三行的文字                                          |
| 3,5p  | 打印第三行到第五行的文字                                  |
| .     | 代表当前行                                                |
|       | 代表当前文件的所有行                                      |
| '<,'> | 高亮选择的区域(可以在可视模式下按下`:`选中高亮区域的范围) |
| 'm    | 包含标记m的行                                             |
| $     | 文件最后一行                                              |
|       | 虚拟行，文件最上方的行                                    |

### 技巧15：copy命令和move命令

| 命令                  | 描述                                                      |
| --------------------- | --------------------------------------------------------- |
| :[range]copy{address} | 把range范围内的文本复制到address处，copy命令可以用`t`简写 |
| :[range]move{address} | 把range范围内的文本移动到address处，move命令可以用`m`简写 |

### 技巧16：运行shell命令

| 命令                 | 描述                                                 |
| -------------------- | ---------------------------------------------------- |
| :write !{cmd}        | 缓冲区内容作为标准输入给外部执行命令Z{cmd}           |
| :write! sh           | 把缓冲区内容写入文件sh                               |
| :shell               | 启动一个 shell (输入 exit 返回 Vim)                  |
| :read !{cmd}         | 在 shell 中执行 {cmd} ，并把其标准输出插入到光标下方 |
| :[range]write !{cmd} | shell 中执行 {cmd} ，以 [range] 作为其标准输入       |
| :[range]!{filter}    | 使用外部程序 {filter} 过滤指定的 [range]             |

## 管理多个文件

### 技巧17：缓冲区

| 命令               | 用途                      |
| ------------------ | ------------------------- |
| :ls                | 列出缓冲区文件列表        |
| :args              | 列出参数列表              |
| :args  file1 file2 | 将文件加入参数列表        |
| :argdo {cmd}       | 在每个缓冲区运行命令{cmd} |

> 参数列表和缓冲区列表是独立的，可以分别用`next`和`bnext`进行文件在对应列表的切换

### 技巧18：处理缓冲区

| 命令     | 描述                                       |
| -------- | ------------------------------------------ |
| :w[rite] | 把缓冲区内容写入磁盘                       |
| :e[dit]! | 把磁盘文件内容读入缓冲区（即回滚所做修改） |
| :qa[ll]! | 关闭所有窗口，摒弃修改而无需警告           |
| :wa[ll]! | 把所有改变的缓冲区写入磁盘                 |

## 打开及保存文件

### 技巧19：用edit命令打开

默认情况下在某个vim的工作目录不会随着打开的文件而变更，虽然可以设置，但是我们可以用某些字符表示打开的缓冲区文件路径。

`%` 表示缓冲区文件的路径，`%:h` 则表示打开的缓冲区文件的目录。

`find`命令也可以查找文件，需要配合path来指定搜索的目录。

### 技巧20：以超级用户权限保存文件

这个功能我爱了，经常更改一些配置文件，但是写完了保存发现自己没有权限，不得不退出重新编写一遍。

`:w !sudo tee % > /dev/null` 命令完美的解决了这个问题，:w !{cmd}可以将缓冲区内容作为标准输入传给外部调用的shell程序，这里利用`tee` 命令把标准输入写入 `%`指定的当前文件路径，因为`tee` 命令同样的会产生标准输出，再将标准输出重定向到 /dev/null中。

## 用动作命令在文档中移动

### 技巧21：用精确的文本对象选择选区

vim的文本对象只能由两个字符`a`和`i`开头。

| 文本对象 | 选择区域                    |
| -------- | --------------------------- |
| a) 或 ab | 一对圆括号 (parentheses)    |
| i) 或 ib | 圆括号 (parentheses) 内部   |
| a} 或 aB | 一对花括号 {braces}         |
| i} 或 iB | 花括号 {braces} 内部        |
| a]       | 一对方括号 [brackets]       |
| i]       | 方括号 [brackets] 内部      |
| a'       | 一对单引号 'single quotes'  |
| i'       | 单引号 'single quotes' 内部 |
| a"       | 一对双引号 "double quotes"  |
| i"       | 双引号 "double quotes" 内部 |
| a`       | 一对反引号 `backticks`      |
| i`       | 反引号 `backticks` 内部     |
| at       | 一对 XML 标签 tags          |
| it       | XML 标签内部                |

### 技巧22：删除周边，修改内部

| 文本对象 | 选择范围           |
| -------- | ------------------ |
| iw       | 当前单词           |
| aw       | 当前单词及一个空格 |
| iW       | 当前字串           |
| aW       | 当前字串及一个空格 |
| is       | 当前句子           |
| as       | 当前句子及一个空格 |
| ip       | 当前段落           |
| ap       | 当前段落及一个空行 |

> `%`移动命令可以在对应括号处跳转

## 寄存器

### 技巧23：寄存器复制粘贴

vim中剪切，复制粘贴是利用寄存器来实现的。

默认的所有剪切，复制都到无名寄存器，会覆盖。

| 寄存器 | 描述                 |
| ------ | -------------------- |
| ""     | 默认无名寄存器       |
| "0     | 复制专用寄存器，yank |
| "a-"z  | a-z命名的寄存器      |
| "+     | 系统剪切板           |
| "=     | 表达式寄存器         |

在插入模式下可以用`<C-r>" `插入无名寄存器的内容，`<C-r>0` 插入复制寄存器的内容。

## 宏

### 技巧24：宏的读取和执行

录制宏是通过按下`q{register}`然后开始录制宏，保存在寄存器中然后按下`q`停止录制。

通过`@{register}`来执行录制的宏，也可以通过`@@`来执行最近的宏。

